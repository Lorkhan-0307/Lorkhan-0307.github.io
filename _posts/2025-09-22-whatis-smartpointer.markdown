---
layout: post
title: "μ¤λ§νΈ ν¬μΈν„°(Smart Pointer) - C++/C#/CS κΈ°μ΄"
date: 2025-09-22 15:00:00 +0900
categories: [Tech Interview, Study Plan]
tags: [c++, c#, computer-science, algorithm, data-structure, operating-system, network, database, design-pattern]
slug: whatis-smartpointer
---

# μ¤λ§νΈ ν¬μΈν„°(Smart Pointer)

## π“ κ°λ… μ •λ¦¬
- **μ¤λ§νΈ ν¬μΈν„°**: ν¬μΈν„°μ²λΌ λ™μ‘ν•μ§€λ§, κ°μ²΄μ μ†λ©Έ μ‹ μλ™μΌλ΅ λ©”λ¨λ¦¬ ν•΄μ   
- C++11 μ΄ν›„ λ„μ…λ μλ™ λ©”λ¨λ¦¬ κ΄€λ¦¬ λ„κµ¬
- C++11 μ΄ν›„ ν‘μ¤€ μ κ³µ: `unique_ptr`, `shared_ptr`, `weak_ptr`  
- ν•µμ‹¬ μ•„μ΄λ””μ–΄: μ°Έμ΅° μΉ΄μ΄νΈ, μ†μ κ¶ κ°λ…μ„ μ΄μ©ν•μ—¬ `delete`λ¥Ό μλ™ν™”  

## π“ ν•™μµ λ©ν‘
- C++μ—μ„ [μ¤λ§νΈν¬μΈν„°]({{ site.baseurl }}/posts/whatis-smartpointer/)μ ν•„μ”μ„±κ³Ό μ›λ¦¬ μ΄ν•΄  
- `unique_ptr`, `shared_ptr`, `weak_ptr`μ μ°¨μ΄ ν•™μµ  
- λ©”λ¨λ¦¬ λ„μ λ°©μ§€μ™€ RAIIμ™€μ κ΄€κ³„ μ΄ν•΄  


---

## π“ μ¤λ§νΈ ν¬μΈν„°λ€?

μ¤λ§νΈ ν¬μΈν„°λ” C++μ νΉλ³„ν• ν΄λμ¤ νƒ€μ…μΌλ΅, ν¬μΈν„°μ²λΌ λ™μ‘ν•μ§€λ§ μ¤μ¤λ΅ λ©”λ¨λ¦¬λ¥Ό κ΄€λ¦¬ν•λ” ν¬μΈν„°μ…λ‹λ‹¤.
μ΄λ” λ©”λ¨λ¦¬ λ„μλ¥Ό λ°©μ§€ν•κ³ , λ©”λ¨λ¦¬ κ΄€λ¦¬μ λ³µμ΅μ„±μ„ μ¤„μ—¬μ¤λ‹λ‹¤.
μ¤λ§νΈ ν¬μΈν„°λ” κ°μ²΄κ°€ λ” μ΄μƒ ν•„μ”ν•μ§€ μ•μ„ λ• μλ™μΌλ΅ μ‚­μ ν•λ©°, μ΄λ¬ν• κΈ°λ¥ λ•λ¬Έμ— 'μ¤λ§νΈ' λΌκ³  λ¶€λ¦…λ‹λ‹¤.


## μ¤λ§νΈ ν¬μΈν„°μ μ‘λ™ μ›λ¦¬

μ¤λ§νΈ ν¬μΈν„°λ” ν¬μΈν„°μ²λΌ λ™μ‘ν•λ‚, λ©”λ¨λ¦¬λ¥Ό μ§μ ‘ κ΄€λ¦¬ν•λ” κ²ƒμ΄ μ•„λ‹λΌ [RAII]({{ site.baseurl }}/posts/whatis-raii/) μ›μΉ™μ„ μ‚¬μ©ν•΄ λ©”λ¨λ¦¬λ¥Ό μλ™μΌλ΅ κ΄€λ¦¬ν•©λ‹λ‹¤. 
RAIIλ” κ°„λ‹¨ν•κ² μ„¤λ…ν•μλ©΄, κ°μ²΄μ μλ…μ΄ κ·Έ κ°μ²΄κ°€ μ†μ ν• μμ›μ μλ…κ³Ό λ™μΌν•κ² κ΄€λ¦¬λλ” κ²ƒμ„ μλ―Έν•©λ‹λ‹¤. κ·Έλ ‡κΈ°μ—, κ°μ²΄κ°€ μƒμ„±λ  λ• μμ›μ„ ν• λ‹Ήν•κ³ , μ†λ©Έλ  λ• μμ›μ„ ν•΄μ ν•©λ‹λ‹¤.

μ¤λ§νΈ ν¬μΈν„°λ” κΈ°λ³Έμ μΌλ΅ ν…ν”λ¦Ώ ν΄λμ¤λ΅, ν¬μΈν„°μ™€ κ°™μ€ λ°©μ‹μΌλ΅ μ‚¬μ©ν•  μ μμµλ‹λ‹¤. μ¤λ§νΈ ν¬μΈν„° κ°μ²΄κ°€ μ†λ©Έλ  λ•, μ¤λ§νΈ ν¬μΈν„°λ” μμ‹ μ΄ κ°€λ¦¬ν‚¤λ” λ©”λ¨λ¦¬λ¥Ό μλ™μΌλ΅ ν•΄μ ν•μ—¬, ν”„λ΅κ·Έλλ¨Έκ°€ λ©”λ¨λ¦¬ ν•΄μ λ¥Ό μμ–΄λ²„λ¦¬λ” λ¬Έμ λ¥Ό μλ°©ν•©λ‹λ‹¤. 

μ¤λ§νΈ ν¬μΈν„°μ μ‘λ™ μ›λ¦¬λ” C++μ μƒμ„±μμ™€ μ†λ©Έμμ λ€ν• μ΄ν•΄κ°€ ν•„μ”ν•©λ‹λ‹¤.
μƒμ„±μλ” κ°μ²΄κ°€ μƒμ„±λ  λ• νΈμ¶λκ³ , μ†λ©Έμλ” κ°μ²΄κ°€ μ†λ©Έν•  λ• νΈμ¶λλ”λ°, μ¤λ§νΈ ν¬μΈν„°λ” μƒμ„±μμ—μ„ λ©”λ¨λ¦¬λ¥Ό ν• λ‹Ήν•κ³ , μ†λ©Έμμ—μ„ λ©”λ¨λ¦¬λ¥Ό ν•΄μ ν•©λ‹λ‹¤.

μ¤λ§νΈ ν¬μΈν„°λ” λ‚΄λ¶€μ— μ›μ‹ ν¬μΈν„°(raw pointer)λ¥Ό λ³΄κ΄€ν•κ³  μμΌλ©°, μ΄ μ›μ‹ ν¬μΈν„°λ” μ¤λ§νΈ ν¬μΈν„°κ°€ κ°€λ¦¬ν‚¤λ” μ‹¤μ  λ©”λ¨λ¦¬λ¥Ό κ°€λ¦¬ν‚µλ‹λ‹¤. ν•μ§€λ§, μ‚¬μ©μλ” μ΄ μ›μ‹ ν¬μΈν„°μ— μ§μ ‘ μ ‘κ·Όν•  μ μ—†μΌλ©°, μ¤λ§νΈ ν¬μΈν„°κ°€ μ κ³µν•λ” μΈν„°νμ΄μ¤λ¥Ό ν†µν•΄μ„λ§ λ©”λ¨λ¦¬μ— μ ‘κ·Όν•  μ μμµλ‹λ‹¤.

```cpp
unique_ptr<int> p1 = make_unique<int>(42);
*p1 = 20;
```

λν• μ¤λ§νΈ ν¬μΈν„°λ” μ†μ κ¶(ownership)μ„ λ„μ…ν•μ—¬, λ™μΌν• λ©”λ¨λ¦¬μ— λ€ν• μ ‘κ·Όμ„ κ΄€λ¦¬ν•©λ‹λ‹¤.
μμ‹λ΅, `unique_ptr`μ€ ν•λ‚μ μ¤λ§νΈ ν¬μΈν„°λ§ λ©”λ¨λ¦¬λ¥Ό μ†μ ν•  μ μκ² ν•μ—¬, λ©”λ¨λ¦¬ ν•΄μ  μ‹μ— λ°μƒν•  μ μλ” ν•΄μ  ν›„ μ‚¬μ©(dangling pointer)λ‚ μ¤‘λ³µ ν•΄μ μ λ¬Έμ λ¥Ό ν•΄κ²°ν•©λ‹λ‹¤.


## μ¤λ§νΈ ν¬μΈν„°μ μΆ…λ¥

### 1. unique_ptr
- λ‹¨μΌ μ†μ κ¶ β†’ λ³µμ‚¬ λ¶κ°€, μ΄λ™λ§ κ°€λ¥  
- κ°€μ¥ κ°€λ³κ³  μ•μ „  

### 2. shared_ptr
- μ°Έμ΅° μΉ΄μ΄ν… κΈ°λ°  
- μ—¬λ¬ κ°μ ν¬μΈν„°κ°€ ν•λ‚μ μμ› κ³µμ  κ°€λ¥  
- μ°Έμ΅° μΉ΄μ΄νΈκ°€ 0μ΄ λλ©΄ μλ™ ν•΄μ   
- λ¶ν•„μ”ν• μ°Έμ΅° μΉ΄μ΄νΈκ°€ λ§μ•„μ§€λ©΄ μ„±λ¥ μ €ν• λ°μƒ κ°€λ¥
- μν™ μ°Έμ΅° λ¬Έμ κ°€ λ°μƒ κ°€λ¥

### 3. weak_ptr
- `shared_ptr`μ μν™ μ°Έμ΅° λ¬Έμ λ¥Ό ν•΄κ²°ν•κΈ° μ„ν•΄ μ‚¬μ©  
- μ°Έμ΅° μΉ΄μ΄νΈλ¥Ό μ¦κ°€μ‹ν‚¤μ§€ μ•μ  
- κ°μ²΄μ μλ…μ— μν–¥μ„ μ£Όμ§€ μ•λ” μ•½ν• μ°Έμ΅°(weak reference)λ¥Ό μ κ³µ -> μν™ μ°Έμ΅° ν•΄κ²°!

---

## π’» μμ  μ½”λ“
```cpp
#include <iostream>
#include <memory>
using namespace std;

void UniquePtrDemo() {
    unique_ptr<int> p1 = make_unique<int>(42);
    // unique_ptr<int> p2 = p1; // β λ³µμ‚¬ λ¶κ°€
    unique_ptr<int> p3 = move(p1); // β… μ΄λ™
}

void SharedPtrDemo() {
    shared_ptr<int> sp1 = make_shared<int>(100);
    shared_ptr<int> sp2 = sp1; // μ°Έμ΅° μΉ΄μ΄νΈ μ¦κ°€
    cout << "use_count: " << sp1.use_count() << endl; // 2
}

void WeakPtrDemo() {
    shared_ptr<int> sp = make_shared<int>(200);
    weak_ptr<int> wp = sp; // μν™ μ°Έμ΅° λ°©μ§€
    if (auto locked = wp.lock()) {
        cout << *locked << endl;
    }
}
```


### μν™ μ°Έμ΅° λ¬Έμ 

#### λ¬Έμ  λ°μƒ μμ‹

λ‹¤μ μμ  μ½”λ“μ—μ„, Aμ™€ B κ°μ²΄λ” μ„λ΅λ¥Ό μ°Έμ΅°ν•μ—¬, μν™ μ°Έμ΅°κ°€ λ°μƒν•κ³  μ΄λ΅ μΈν•΄ Reference Countκ°€ 0μ΄ λμ§€ μ•μ•„ λ©”λ¨λ¦¬κ°€ λ„μλλ‹¤.

```cpp
#include <iostream>
#include <memory>
using namespace std;

struct B;
struct A{
    shared_ptr<B> b_ptr;
};

struct B{
    shared_ptr<A> a_ptr;
};

void main() {
    shared_ptr<A> a(new A());
    shared_ptr<B> b(new B());

    a->b_ptr = b;
    b->a_ptr = a; // μν™ μ°Έμ΅°κ°€ μƒμ„±λλ‹¤.
}
```

#### ν•΄κ²° μμ‹

λ‹¤μ ν•΄κ²° μμ  μ½”λ“μ—μ„λ” Bκ°€ `weak_ptr`λ¥Ό μ‚¬μ©ν•μ—¬ Aλ¥Ό μ°Έμ΅°ν•κΈ° λ•λ¬Έμ— μν™ μ°Έμ΅°κ°€ λ°μƒν•μ§€ μ•λ”λ‹¤.
Aκ°€ νκ΄΄λλ©΄ `weak_ptr`λ” μλ™μΌλ΅ nullptrλ΅ μ„¤μ •λκ³ , `weak_ptr`λ” `lock()` ν•¨μλ¥Ό μ‚¬μ©ν•μ—¬ `shared_ptr`λ΅ λ³€ν™λ  μ μλ‹¤.
μ΄ ν•¨μλ” ν•΄λ‹Ή κ°μ²΄κ°€ μ—¬μ „ν μ΅΄μ¬ν•λ” κ²½μ°μ—λ§ `shared_ptr`λ¥Ό λ°ν™ν•κΈ°μ—, λ©”λ¨λ¦¬μ— μ•μ „ν•κ² μ ‘κ·Όν•  μ μλ‹¤. 

```cpp
#include <iostream>
#include <memory>
using namespace std;

struct B;
struct A{
    shared_ptr<B> b_ptr;
};

struct B{
    weak_ptr<A> a_ptr; // μ•½ν• μ°Έμ΅°λ¥Ό μ‚¬μ©ν•λ‹¤.
};

void main() {
    shared_ptr<A> a(new A());
    shared_ptr<B> b(new B());

    a->b_ptr = b;
    b->a_ptr = a; // μν™ μ°Έμ΅°κ°€ λ°μƒν•μ§€ μ•λ”λ‹¤.

    if(shared_ptr<A> a_locked = b->a_ptr.lock()){
        // do something
    }
    else{
        // already destroied
    }
}
```

---

## π― μ—°μµ λ¬Έμ 
1. `unique_ptr`λ΅ λ™μ  λ°°μ—΄μ„ κ΄€λ¦¬ν•λ” μμ λ¥Ό μ‘μ„±ν•μ„Έμ”.  
2. `shared_ptr` μν™ μ°Έμ΅° λ¬Έμ λ¥Ό μ½”λ“λ΅ μ‹λ®¬λ μ΄μ…ν•κ³ , `weak_ptr`λ΅ ν•΄κ²°ν•΄λ³΄μ„Έμ”.  
3. `unique_ptr`κ³Ό `shared_ptr`μ μ„±λ¥ μ°¨μ΄λ¥Ό λΉ„κµν•΄λ³΄μ„Έμ”.  

---

## π” μ‹¬ν™” ν•™μµ
- `shared_ptr`μ μ μ–΄ λΈ”λ΅ κµ¬μ΅°  
- `enable_shared_from_this` μ‚¬μ©λ²•  
- `scoped_ptr`(Boost)μ™€ ν‘μ¤€ μ¤λ§νΈ ν¬μΈν„° λΉ„κµ  



### 1. Shared pointer μ μ μ–΄ λΈ”λ΅ κµ¬μ΅°

Shared pointerλ” λ‹¤μ λ„¤κ°μ μ •λ³΄λ¥Ό κ°€μ§„λ‹¤.

1. Strong Reference Count
- ν„μ¬ κ°μ²΄λ¥Ό μ†μ ν•λ” κ°―μ(shared_ptr)
- `shared_ptr`μ΄ λ³µμ‚¬/μ΄λ™λλ©΄ μ¦κ°€ν•κ³  μ†λ©Έν•λ©΄ κ°μ†ν•λ‹¤.
- 0μ΄ λλ©΄ μ‹¤μ  κ°μ²΄λ¥Ό μ‚­μ ν•λ‹¤(delete νΈμ¶).

2. Weak Reference Count
- `weak_ptr` κ°μ μ¶”μ 
- `shared_ptr`κ°€ λ¨λ‘ μ‚¬λΌμ Έλ„, `weak_ptr`κ°€ λ‚¨μ•„μμΌλ©΄ μ μ–΄ λΈ”λ΅μ€ μ μ§€λλ‹¤.
- λ§μ§€λ§‰ `weak_ptr`κ°€ ν•΄μ λ  λ• μ μ–΄ λΈ”λ΅ μμ²΄λ„ ν•΄μ λλ‹¤(μ¦‰, κ°μ²΄λ” μ‚¬λΌμ Έλ„ μ μ–΄ λΈ”λ΅μ€ λ‚¨μ•„μμ„ μ μλ‹¤).

3. μ‚­μ μ(Deleter)
- κ°μ²΄λ¥Ό μ‚­μ ν•  λ°©λ²•μ„ μ €μ¥ν•λ‹¤(delete, free, custom ν•¨μ λ“±).

4. ν• λ‹Ήμ(Allocator)
- λ©”λ¨λ¦¬ ν•΄μ λ¥Ό μ μ–΄ν•  μ μλ„λ΅ μ„ νƒμ μΌλ΅ μ €μ¥λλ‹¤.


### 2. enable_shared_from_this

enable_shared_from_this<T>λ¥Ό μƒμ†λ°›μΌλ©΄, κ°μ²΄κ°€ `shared_ptr`λ΅ κ΄€λ¦¬λ  λ• λ‚΄λ¶€μ μΌλ΅ μμ‹ μ μ μ–΄ λΈ”λ΅μ„ μ•κ³  μλ” **μ•½ν• μ°Έμ΅°(weak_ptr)**λ¥Ό μ €μ¥ν•λ‹¤.
μ΄λ¥Ό ν†µν•΄, enable_shared_from_this() λ¥Ό ν†µν•΄ μ‹ κ· μ μ–΄ λΈ”λ΅μ΄ μ•„λ‹, κΈ°μ΅΄ μ μ–΄ λΈ”λ΅μ„ κ³µμ ν•λ” `shared_ptr`λ¥Ό μ κ³µλ°›λ” ν•¨μμ΄λ‹¤.

```
#include <iostream>
#include <memory>

struct Foo : std::enable_shared_from_this<Foo> {
    std::shared_ptr<Foo> getPtr() {
        return shared_from_this(); // β… μ•μ „
    }
    ~Foo() { std::cout << "Foo destroyed\n"; }
};

int main() {
    auto sp1 = std::make_shared<Foo>();
    auto sp2 = sp1->getPtr(); // κ°™μ€ control block κ³µμ 

    std::cout << sp1.use_count() << "\n"; // 2
    std::cout << sp2.use_count() << "\n"; // 2
}
```

3. Boost ptrλ” Obsolete. μ΄μ λ” μ‚¬μ©ν•μ§€ μ•λ”λ‹¤.

---

## π νκ³ 
- μ™ μ—¬μ „ν `raw pointer`κ°€ ν•„μ”ν• κ²½μ°κ°€ μμ„κΉ?  
- μ¤λ§νΈ ν¬μΈν„° μ‚¬μ© μ‹ μ£Όμν•΄μ•Ό ν•  μ μ€ λ¬΄μ—‡μΌκΉ?  

---

## π”— κ΄€λ ¨ νμ΄μ§€
- [C++ λ©”λ¨λ¦¬ κ΄€λ¦¬]({{ site.baseurl }}/posts/cpp-memory-management/)  
- [RAII]({{ site.baseurl }}/posts/whatis-raii/)  